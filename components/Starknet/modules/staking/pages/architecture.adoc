[id="staking_architecture"]
= Staking Architecture

Staking on Starknet is designed to enhance network security and decentralization by allowing users to stake their STRK tokens directly or delegate them to other stakers. The architecture is modular, with different contracts handling specific responsibilities to ensure flexibility, security, and ease of upgrades.

== Components of the Staking System

Staking on Starknet is divided into several key components, each responsible for different aspects of the staking process:

.Components of the Staking System
[#staking_components_table]
[cols='1,8']
|===
| Component
| Description

| Staking Contract
| The central contract that manages the staking process. It handles direct staking, rewards distribution, and interactions with delegation pools. Stakers interact with this contract to stake their tokens, claim rewards, and initiate unstaking.

| Delegation Pooling Contract
| This contract manages the delegation process, allowing delegators to pool their tokens with a staker. The contract is responsible for tracking each delegator's share, calculating their rewards, and managing the delegation and unstaking processes.

| StakerInfo Structure
| A data structure stored within the Staking Contract that holds detailed information about each staker, including their staked amount, unclaimed rewards, delegation details, and operational parameters.

| PoolMemberInfo Structure
| A data structure stored within the Delegation Pooling Contract that holds information about each delegator's contributions, rewards, and status within the pool.

| Reward Supplier Contract
| A dedicated contract that calculates and supplies the rewards for stakers and delegators. It interfaces with the Staking Contract to distribute rewards based on the defined minting curve.

| Minting Curve Contract
| A contract responsible for implementing the minting curve logic that governs the reward distribution mechanism. It adjusts rewards dynamically based on the total staked amount and the overall supply of STRK tokens.

|===

== Staking Contract

The Staking Contract is the core of the staking system. It manages the lifecycle of stakers, from the initial stake to claiming rewards and unstaking. The contract ensures that the staker's tokens are securely locked and that rewards are distributed according to the minting curve.

*Key Functions and Responsibilities*: +
`stake`: Allows users to stake their STRK tokens directly into the contract. The function initializes the staker's information, locks the tokens, and optionally deploys a delegation pool if pooling is enabled. +
`increase_stake`: Lets existing stakers add more tokens to their stake. The contract recalculates rewards and updates the staker's information accordingly. +
`unstake_intent`: Initiates the unstaking process by locking the staker's tokens for a specified exit period. No rewards are earned during this period. +
`unstake_action`: Finalizes the unstaking process after the exit period has passed, releasing the staked tokens back to the staker. +
`claim_rewards`: Calculates and transfers the staker's accumulated rewards to their designated reward address. +
`add_to_delegation_pool`: Allows delegation pooling contracts to add funds to a staker's pool. This function updates the staker's pooled amount and recalculates rewards. +
`switch_staking_delegation_pool`: Enables delegators to move their stake from one staker's pool to another. This function handles the transfer of funds and updates both stakers' and delegators' records. +
`contract_parameters`: Returns general parameters of the contract, such as the minimum stake amount and the current global index. +

== Delegation Pooling Contract

The Delegation Pooling Contract enables users to delegate their tokens to a staker without having to manage the staking process themselves. This contract tracks each delegator's contribution, calculates their rewards, and manages the delegation lifecycle.

*Key Functions and Responsibilities*: +
`enter_delegation_pool`: Allows users to delegate their tokens to the pool managed by a staker. This function transfers the tokens, updates the delegator's record, and integrates them into the staker's pool. +
`add_to_delegation_pool`: Enables existing pool members to increase their delegation amount. The contract updates the pool's total and recalculates the member's rewards. +
`exit_delegation_pool_intent`: Initiates the process for a delegator to exit the pool. Similar to stakers, the delegator's funds are locked for a period before they can be withdrawn. +
`exit_delegation_pool_action`: Finalizes the exit process for a delegator, returning their tokens and any unclaimed rewards. +
`switch_delegation_pool`: Allows a delegator to transfer their delegated stake from one staker's pool to another, facilitating dynamic delegation strategies. +
`claim_rewards`: Transfers the delegator's earned rewards to their specified reward address. +
`contract_parameters`: Returns the staker's information, such as the staker address, the staking contract address, and the commission rate.

== Reward Supplier Contract

The Reward Supplier Contract is responsible for calculating and supplying the staking rewards based on the minting curve. It ensures that the rewards are distributed fairly and in accordance with the protocol's economic parameters.

*Key Functions and Responsibilities*: +
`calculate_staking_rewards`: Computes the rewards based on the current staking rate and the minting curve, updating the Staking Contract with the amount to be distributed. +
`claim_rewards`: Handles the transfer of rewards to the Staking Contract, ensuring that the correct amount is distributed to stakers and delegators. +

== Minting Curve Contract

The Minting Curve Contract defines the economic model that governs reward distribution. It ensures that the network's inflation is managed while incentivizing participation in staking.

*Key Functions and Responsibilities*: +
`yearly_mint`: Returns the amount of STRK tokens to be minted annually based on the current staking rate. This function uses a square root formula to balance rewards and inflation. +
`update_total_supply`: Updates the total supply of STRK tokens, ensuring that the minting calculations remain accurate.

== Security and Upgradability

The staking architecture on Starknet is designed with security and upgradability in mind. Each contract is modular, allowing for targeted upgrades and improvements without affecting the entire system. Access control mechanisms are in place to ensure that only authorized parties can make critical changes, further enhancing the security of the staking process.

== Additional Resources

* _Staking Developer's Reference_:
  * xref:function-reference.adoc#stake[`stake` function, `Stake` event]
  * xref:function-reference.adoc#unstake[`unstake` function]
  * xref:function-reference.adoc#initiate_unstake[`initiate_unstake` function]